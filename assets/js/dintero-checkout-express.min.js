/*! For license information please see dintero-checkout-express.min.js.LICENSE.txt */
(()=>{var e={922(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},143(e,t,o){var n=o(448);function r(){var t,o,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.toStringTag||"@@toStringTag";function c(e,r,i,a){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return n(c,"_invoke",function(e,n,r){var i,a,s,c=0,l=r||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,o){return i=e,a=0,s=t,p.n=o,u}};function f(e,n){for(a=e,s=n,o=0;!d&&c&&!r&&o<l.length;o++){var r,i=l[o],f=p.p,h=i[2];e>3?(r=h===n)&&(s=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=f&&((r=e<2&&f<i[1])?(a=0,p.v=n,p.n=i[1]):f<h&&(r=e<3||i[0]>n||n>h)&&(i[4]=e,i[5]=n,p.n=h,a=0))}if(r||e>1)return u;throw d=!0,n}return function(r,l,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,h),a=l,s=h;(o=a<2?t:s)||!d;){i||(a?a<3?(a>1&&(p.n=-1),f(a,s)):p.n=s:p.v=s);try{if(c=2,i){if(a||(r="next"),o=i[r]){if(!(o=o.call(i,s)))throw TypeError("iterator result is not an object");if(!o.done)return o;s=o.value,a<2&&(a=0)}else 1===a&&(o=i.return)&&o.call(i),a<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),a=1);i=t}else if((o=(d=p.n<0)?s:e.call(n,p))!==u)break}catch(e){i=t,a=1,s=e}finally{c=1}}return{value:o,done:d}}}(e,i,a),!0),c}var u={};function l(){}function d(){}function p(){}o=Object.getPrototypeOf;var f=[][a]?o(o([][a]())):(n(o={},a,function(){return this}),o),h=p.prototype=l.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return d.prototype=p,n(h,"constructor",p),n(p,"constructor",d),d.displayName="GeneratorFunction",n(p,s,"GeneratorFunction"),n(h),n(h,s,"Generator"),n(h,a,function(){return this}),n(h,"toString",function(){return"[object Generator]"}),(e.exports=r=function(){return{w:c,m}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},275(e,t,o){var n=o(361);e.exports=function(e,t,o,r,i){var a=n(e,t,o,r,i);return a.next().then(function(e){return e.done?e.value:a.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},361(e,t,o){var n=o(143),r=o(273);e.exports=function(e,t,o,i,a){return new r(n().w(e,t,o,i),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},273(e,t,o){var n=o(922),r=o(448);e.exports=function e(t,o){function i(e,r,a,s){try{var c=t[e](r),u=c.value;return u instanceof n?o.resolve(u.v).then(function(e){i("next",e,a,s)},function(e){i("throw",e,a,s)}):o.resolve(u).then(function(e){c.value=e,a(c)},function(e){return i("throw",e,a,s)})}catch(e){s(e)}}var a;this.next||(r(e.prototype),r(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r(this,"_invoke",function(e,t,n){function r(){return new o(function(t,o){i(e,n,t,o)})}return a=a?a.then(r,r):r()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},448(e){function t(o,n,r,i){var a=Object.defineProperty;try{a({},"",{})}catch(o){a=0}e.exports=t=function(e,o,n,r){function i(o,n){t(e,o,function(e){return this._invoke(o,n,e)})}o?a?a(e,o,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[o]=n:(i("next",0),i("throw",1),i("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(o,n,r,i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},51(e){e.exports=function(e){var t=Object(e),o=[];for(var n in t)o.unshift(n);return function e(){for(;o.length;)if((n=o.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},771(e,t,o){var n=o(922),r=o(143),i=o(275),a=o(361),s=o(273),c=o(51),u=o(9);function l(){"use strict";var t=r(),o=t.m(l),d=(Object.getPrototypeOf?Object.getPrototypeOf(o):o.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))}var f={throw:1,return:2,break:3,continue:3};function h(e){var t,o;return function(n){t||(t={stop:function(){return o(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return o(n.a,f[e],t)},delegateYield:function(e,r,i){return t.resultName=r,o(n.d,u(e),i)},finish:function(e){return o(n.f,e)}},o=function(e,o,r){n.p=t.prev,n.n=t.next;try{return e(o,r)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=l=function(){return{wrap:function(e,o,n,r){return t.w(h(e),o,n,r&&r.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:s,async:function(e,t,o,n,r){return(p(t)?a:i)(h(e),t,o,n,r)},keys:c,values:u}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports},9(e,t,o){var n=o(948).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],o=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},948(e){function t(o){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},758(e,t,o){var n=o(771)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,o,n,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void o(e)}s.done?t(c):Promise.resolve(c).then(n,r)}var t=o(758),n=o.n(t);jQuery(function(t){if(dinteroCheckoutParams){dinteroCheckoutParams;var o={bodyEl:t("body"),checkoutFormSelector:"form.checkout",preventPaymentMethodChange:!1,selectAnotherSelector:"#dintero-checkout-select-other",paymentMethodEl:t('input[name="payment_method"]'),checkout:null,validation:!1,isLocked:!1,updateTimer:null,alreadyRedirected:!1,delayUpdateCheckout:function(){o.updateTimer&&clearTimeout(o.updateTimer),!1===o.isLocked&&null!==o.checkout?(o.isLocked=!0,o.checkout.lockSession()):o.updateCheckout(),o.updateTimer=setTimeout(function(){t(document.body).trigger("update_checkout"),o.updateTimer=null},1e3)},init:function(){t(document).ready(o.documentReady),o.bodyEl.on("change",'input[name="payment_method"]',o.maybeChangeToDinteroCheckout),o.bodyEl.on("click",o.selectAnotherSelector,o.changeFromDinteroCheckout),0!==t("#dintero-checkout-iframe").length?o.renderIframe():console.error("Dintero Checkout: Could not find the container for the iframe."),t("body").on("updated_checkout",function(){0===t("#dintero-checkout-iframe").length&&o.isSelectedGateway()&&window.location.reload()}),o.bodyEl.on("update_checkout",o.updateCheckout),o.bodyEl.on("updated_checkout",o.updatedCheckout),o.bodyEl.on("updated_checkout",o.maybeDisplayShippingPrice)},updateCheckout:function(){null===o.checkout||o.validation||t(o.checkoutFormSelector).append('<input type="hidden" name="dintero_locked" id="dintero_locked" value=1>')},updatedCheckout:function(){null===o.checkout||o.validation||(t("#dintero_locked").remove(),o.isLocked=!1,o.checkout.refreshSession())},renderIframe:function(){return(r=n().mark(function e(){var r;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t("#dintero-checkout-iframe")[0],dintero.embed({container:r,sid:dinteroCheckoutParams.SID,popOut:1==dinteroCheckoutParams.popOut,language:dinteroCheckoutParams.language,onSession:function(e,t){void 0!==e.session&&void 0!==e.session.order?(o.updateAddress(e.session.order.billing_address,e.session.order.shipping_address),e.session.order.shipping_option&&dinteroCheckoutParams.shipping_in_iframe&&o.shippingMethodChanged(e.session.order.shipping_option)):t.refreshSession()},onPayment:function(e,t){o.alreadyRedirected||(o.alreadyRedirected=!0,window.location=e.href)},onPaymentError:function(e,n){n.destroy(),t.ajax({type:"POST",dataType:"json",data:{nonce:dinteroCheckoutParams.print_notice_nonce,message:"A payment error was encountered.",notice_type:"error"},url:dinteroCheckoutParams.print_notice_url,complete:function(){o.unsetSession(e.href)}})},onSessionCancel:function(e,t){t.destroy(),o.unsetSession(e.href)},onSessionNotFound:function(e,t){o.unsetSession(window.location.pathname)},onSessionLocked:function(e,t,n){o.delayUpdateCheckout()},onSessionLockFailed:function(e,t){console.warn("Failed to lock the checkout.",e)},onActivePaymentType:function(e,t){},onValidateSession:function(e,n,r){o.logToFile(dinteroCheckoutParams.SID+" | Validating session with id: "+e.session.id),t("#dintero-checkout-wc-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.validation=!0,o.updateAddress(e.session.order.billing_address,e.session.order.shipping_address,!0),0<t("form.checkout #terms").length&&t("form.checkout #terms").prop("checked",!0);var i=n.session.id;o.submitOrder(r,i),o.validation=!1}}).then(function(e){o.checkout=e});case 1:case"end":return e.stop()}},e)}),function(){var t=this,o=arguments;return new Promise(function(n,i){var a=r.apply(t,o);function s(t){e(a,n,i,s,c,"next",t)}function c(t){e(a,n,i,s,c,"throw",t)}s(void 0)})})();var r},unsetSession:function(e){t.ajax({type:"POST",dataType:"json",data:{nonce:dinteroCheckoutParams.unset_session_nonce},url:dinteroCheckoutParams.unset_session_url,complete:function(){window.location.replace(e)}})},documentReady:function(){0<t('input[name="payment_method"]').length?o.paymentMethod=t('input[name="payment_method"]').filter(":checked").val():o.paymentMethod="dintero_checkout",dinteroCheckoutParams.payForOrder||"dintero_checkout"!==o.paymentMethod||o.moveExtraCheckoutFields(),o.delayUpdateCheckout()},changeFromDinteroCheckout:function(e){e.preventDefault(),t(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.ajax({type:"POST",dataType:"json",data:{dintero_checkout:!1,nonce:dinteroCheckoutParams.change_payment_method_nonce},url:dinteroCheckoutParams.change_payment_method_url,complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToDinteroCheckout:function(){o.preventPaymentMethodChange||"dintero_checkout"===t(this).val()&&(t(".woocommerce-info").remove(),t(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.ajax({type:"POST",data:{dintero_checkout:!0,nonce:dinteroCheckoutParams.change_payment_method_nonce},dataType:"json",url:dinteroCheckoutParams.change_payment_method_url,complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},isSelectedGateway:function(){return"dintero_checkout"===t('input[name="payment_method"]').filter(":checked").val()},moveExtraCheckoutFields:function(){t(".woocommerce-additional-fields").appendTo("#dintero-express-extra-checkout-fields");for(var e=t('form[name="checkout"] input, form[name="checkout"] select, textarea'),o=0;o<e.length;o++){var n=e[o].name;t("table.woocommerce-checkout-review-order-table").find(e[o]).length||-1===t.inArray(n,dinteroCheckoutParams.standardWooCheckoutFields)&&(0<t("p#"+n+"_field").length?t("p#"+n+"_field").appendTo("#dintero-express-extra-checkout-fields"):t('input[name="'+n+'"]').closest("p").appendTo("#dintero-express-extra-checkout-fields"))}},updateAddress:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("express_popout"===dinteroCheckoutParams.checkout_flow||"express_embedded"===dinteroCheckoutParams.checkout_flow){var i=!1;if(e&&(e.co_address&&(e.first_name=e.first_name||e.co_address.split(" ")[0]||e.business_name,e.last_name=e.last_name||e.co_address.split(" ")[1]||e.business_name),"first_name"in e&&t("#billing_first_name").val(e.first_name),"last_name"in e&&t("#billing_last_name").val(e.last_name),"business_name"in e&&t("#billing_company").val(e.business_name),"address_line"in e&&t("#billing_address_1").val(e.address_line),"postal_code"in e&&t("#billing_postcode").val(e.postal_code),"postal_place"in e&&t("#billing_city").val(e.postal_place),"country"in e&&t("#billing_country").val(e.country),"email"in e&&t("#billing_email").val(e.email),"phone_number"in e&&t("#billing_phone").val(e.phone_number),"billing_only"===dinteroCheckoutParams.woocommerceShipToDestination||dinteroCheckoutParams.allowDifferentBillingShippingAddress||o.saveAddressToShippingFields(e),r&&(t("#billing_first_name").val().trim()||t("#billing_first_name").val("N/A"),t("#billing_last_name").val().trim()||t("#billing_last_name").val("⠀")),i=!0),dinteroCheckoutParams.allowDifferentBillingShippingAddress&&n&&Object.keys(n).length>1){if(o.saveAddressToShippingFields(n),r){var a=t("#shipping_first_name");a.length>0&&!a.val().trim()&&a.val("N/A");var s=t("#shipping_last_name");s.length>0&&!s.val().trim()&&s.val("⠀")}i=!0}i&&!0!==o.validation&&o.delayUpdateCheckout()}},saveAddressToShippingFields:function(e){t("#ship-to-different-address-checkbox").prop("checked",!0),e.co_address&&(e.first_name=e.first_name||e.co_address.split(" ")[0]||e.business_name,e.last_name=e.last_name||e.co_address.split(" ")[1]||e.business_name),"first_name"in e&&t("#shipping_first_name").val(e.first_name),"last_name"in e&&t("#shipping_last_name").val(e.last_name),"business_name"in e&&(0===t("#billing_company").length&&t("#billing_company").val(e.business_name),t("#shipping_company").val(e.business_name)),"address_line"in e&&t("#shipping_address_1").val(e.address_line),"postal_code"in e&&t("#shipping_postcode").val(e.postal_code),"postal_place"in e&&t("#shipping_city").val(e.postal_place),"country"in e&&t("#shipping_country").val(e.country)},shippingMethodChanged:function(e){t("#dintero_shipping_data").val(JSON.stringify(e)),t("body").trigger("dintero_shipping_option_changed",[e]),o.delayUpdateCheckout()},maybeDisplayShippingPrice:function(){if(!t(".dintero-shipping").length&&"dintero_checkout"===o.paymentMethod&&dinteroCheckoutParams.shipping_in_iframe)if(t("#shipping_method input[type='radio']").length)t("#shipping_method input[type='radio']:checked").each(function(){var e=t(this).attr("id"),o=t("label[for='"+e+"']").text();t(".woocommerce-shipping-totals td").html(o),t(".woocommerce-shipping-totals td").addClass("dintero-shipping")});else{var e=t("#shipping_method input[name='shipping_method[0]']").attr("id"),n=t("label[for='"+e+"']").text();t(".woocommerce-shipping-totals td").html(n),t(".woocommerce-shipping-totals td").addClass("dintero-shipping")}},blockForm:function(){t(".woocommerce-checkout-review-order-table").block({message:dinteroCheckoutParams.pip_text,overlayCSS:{background:"#fff"},css:{width:"fit-content",height:"fit-content",padding:"0.2em 0.8em",border:"none"},blockMsgClass:"dintero-checkout-pip"}),t("#dintero-express-extra-checkout-fields").block({message:null,overlayCSS:{background:"#fff"},blockMsgClass:"dintero-checkout-pip"}),t(".dintero-checkout-pip").siblings(".blockOverlay").addClass("dintero-checkout-no-spinner")},unblockForm:function(){t(".woocommerce-checkout-review-order-table").unblock(),t("#dintero-express-extra-checkout-fields").unblock()},submitOrder:function(e,n){this.blockForm(),t.ajax({type:"POST",url:dinteroCheckoutParams.verifyOrderTotalURL,data:{id:n,nonce:dinteroCheckoutParams.verifyOrderTotalNonce},dataType:"json",success:function(n){console.log("order total diff: %s",n.data),n.success?t.ajax({type:"POST",url:dinteroCheckoutParams.submitOrder,data:t("form.checkout").serialize(),dataType:"json",success:function(n){try{if(console.log("try"),"success"!==n.result)throw"Result failed";console.log("submit order success",n),o.logToFile("".concat(dinteroCheckoutParams.SID," | Order ID ").concat(n.order_id," | Order submitted successfully.")),e({success:!0})}catch(i){if(console.log("catch error"),console.error(i),n.messages){var r=n.messages.replace(/<\/?[^>]+(>|$)\s+/g,"");o.printNotice(r),o.logToFile(dinteroCheckoutParams.SID+" | Checkout error | "+r),o.failOrder("submission",r,e)}else o.logToFile(dinteroCheckoutParams.SID+" | Checkout error | No message"),o.failOrder("submission","Checkout error",e);t("#shipping_first_name").val(function(e,t){return"N/A"===t?"":"N/A"}),t("#shipping_last_name").val(function(e,t){return"⠀"===t?"":"⠀"})}},error:function(t){console.log("error data",t),console.log("error data response text",t.responseText);try{o.logToFile(dinteroCheckoutParams.SID+" | AJAX error | "+JSON.stringify(t))}catch(e){o.logToFile(dinteroCheckoutParams.SID+" | AJAX error | Failed to parse error message.")}o.failOrder("ajax-error","Internal Server Error",e)}}):o.failOrder("submit order failed",dinteroCheckoutParams.verifyOrderTotalError,e)},error:function(){o.failOrder("submit order failed",dinteroCheckoutParams.verifyOrderTotalError,e)}})},failOrder:function(e,n,r){console.log("fail order"),r({success:!1,clientValidationError:n}),t("body").trigger("updated_checkout"),t(o.checkoutFormSelector).removeClass("processing"),t(o.checkoutFormSelector).unblock(),this.unblockForm()},printNotice:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";t(".woocommerce-notices-wrapper").first().append("<div class='woocommerce-".concat(o,"' role='alert'>").concat(e,"</div>")),"error"===o&&t(document.body).trigger("checkout_error",[e]),t("html, body").animate({scrollTop:t(".woocommerce-notices-wrapper").offset().top-100},1e3)},logToFile:function(e){t.ajax({url:dinteroCheckoutParams.log_to_file_url,type:"POST",dataType:"json",data:{message:e,nonce:dinteroCheckoutParams.log_to_file_nonce}})}};o.init()}})})()})();
//# sourceMappingURL=dintero-checkout-express.min.js.map